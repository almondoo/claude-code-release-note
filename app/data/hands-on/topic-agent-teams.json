{
  "topicId": "agent-teams",
  "title": "Agent Teams で複数エージェントを協調させる",
  "difficulty": "medium",
  "estimatedTime": "30分",
  "steps": [
    {
      "id": "step-1",
      "label": "STEP 1",
      "title": "Agent Teams の概要を理解する",
      "description": "Agent Teams は Claude Code 内で複数のサブエージェントを起動し、タスクを分担して並行作業を実現する機能です。",
      "blocks": [
        { "type": "highlight", "variant": "tip", "title": "このハンズオンの読み方", "content": "本ガイドでは、仕組みを理解しやすくするために内部ツール名（TeamCreate, TaskCreate など）を記載しています。実際の操作ではこれらを直接呼び出す必要はなく、Claude Code に自然言語で指示するだけで OK です。" },
        { "type": "text", "content": "Agent Teams を使うと、あなたが操作している Claude Code セッション（これを「リーダー」と呼びます）が、複数の子エージェント（「チームメイト」）を自動で起動します。各チームメイトは独立したコンテキストを持ち、並行してファイル編集やコマンド実行を行えます。" },
        { "type": "highlight", "variant": "info", "title": "リーダーとチームメイトの関係", "content": "リーダー = あなたが会話している Claude Code セッション。チームメイト = リーダーが裏で起動する子プロセス。あなたはリーダーに指示を出すだけで、チームメイトとは直接やり取りしません。" },
        { "type": "text", "content": "ユースケース:" },
        { "type": "list", "items": [
          "フロントエンドとバックエンドを同時開発",
          "テスト作成と実装を並行で進める",
          "複数のバグ修正を同時進行",
          "大規模リファクタリングの分担"
        ]},
        { "type": "highlight", "variant": "warning", "title": "前提条件", "content": "Claude Code がインストールされ、正常に動作するセッションが開始されていることが必要です。また、Agent Teams は実験的機能のため、事前に環境変数の設定が必要です（次の STEP で説明します）。" }
      ]
    },
    {
      "id": "step-2",
      "label": "STEP 2",
      "title": "環境変数を設定する",
      "description": "Agent Teams は実験的機能のため、使用前に環境変数の設定が必要です。",
      "blocks": [
        { "type": "text", "content": "Agent Teams はまだ実験的機能（Experimental）として提供されています。使用するには、Claude Code の設定ファイルに環境変数を追加する必要があります。" },
        { "type": "codeBlock", "language": "json", "code": "// ~/.claude/settings.json に追加\n{\n  \"env\": {\n    \"CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS\": \"1\"\n  }\n}", "filename": "~/.claude/settings.json", "caption": "この設定を追加した後、Claude Code を再起動してください" },
        { "type": "highlight", "variant": "warning", "title": "設定ファイルの場所", "content": "~/.claude/settings.json はホームディレクトリ直下の .claude フォルダにあります。ファイルが存在しない場合は新規作成してください。既に他の設定がある場合は、env キーを追加する形でマージしてください。" },
        { "type": "highlight", "variant": "tip", "title": "設定の確認方法", "content": "設定後に Claude Code を起動し、「チームを作成してください」と指示してエラーにならなければ設定完了です。" }
      ]
    },
    {
      "id": "step-3",
      "label": "STEP 3",
      "title": "チームを作成する",
      "description": "自然言語でチーム作成を指示し、作業の土台を準備します。",
      "blocks": [
        { "type": "text", "content": "Claude Code のセッション内で、チームの作成を自然言語で指示します。チーム名と目的を伝えるだけで、必要な設定ファイルが自動的に作成されます。" },
        { "type": "codeBlock", "language": "text", "code": "# Claude Code への指示例:\n「ログイン画面と認証APIを並行で実装したいので、\nチームを作成してください」\n\n# Claude Code が自動で行うこと:\n1. チーム名を決めて作成（例: auth-feature）\n2. チーム設定ファイルと共有タスクリストを生成", "caption": "チーム名は Claude Code が自動で付けますが、指定しても OK です" },
        { "type": "text", "content": "この指示により、以下が自動的にセットアップされます:" },
        { "type": "list", "items": [
          "チーム設定ファイル（メンバー管理用）",
          "共有タスクリスト（進捗管理用）"
        ]},
        { "type": "highlight", "variant": "tip", "title": "チーム名のコツ", "content": "チーム名はプロジェクトや機能を反映した名前にしましょう。例: auth-feature, refactor-api, bug-fixes。日本語名も使えますが、英語の方がファイルパスとの相性が良いです。" }
      ]
    },
    {
      "id": "step-4",
      "label": "STEP 4",
      "title": "タスクを作成してチームメイトを起動する",
      "description": "作業内容を指示すると、リーダーがタスクを作成し、担当するチームメイトを自動で起動します。",
      "blocks": [
        { "type": "text", "content": "リーダー（あなたのセッション）に作業内容を伝えると、タスクの作成とチームメイトの起動が自動で行われます。" },
        { "type": "codeBlock", "language": "text", "code": "# 指示例:\n「以下の2つのタスクを作成して、それぞれ担当エージェントを\n起動してください:\n\n1. ログイン画面の実装\n   - src/pages/Login.tsx にメールアドレス+パスワードのフォームを作成\n   - src/hooks/useAuth.ts に認証状態管理のカスタムフックを作成\n   - バリデーションは zod を使用\n   - 認証APIのエンドポイントは POST /api/auth/login\n\n2. 認証APIの実装\n   - src/routes/auth.ts にログイン・ログアウト・トークンリフレッシュの3エンドポイントを作成\n   - JWT認証（jsonwebtoken パッケージ使用）\n   - src/middleware/requireAuth.ts に認証ミドルウェアを作成」", "caption": "リーダーが自動でタスク作成 → チームメイト起動 → 割り当てを行います" },
        { "type": "highlight", "variant": "info", "title": "タスクの中身", "content": "各タスクには「タイトル」「詳細な説明」「進行中に表示されるラベル」が設定されます。これらはリーダーが自動で適切に設定しますが、指示が曖昧だと説明も曖昧になります。" },
        { "type": "highlight", "variant": "warning", "title": "重要: 指示は具体的に", "content": "「ログイン画面をよろしく」のような曖昧な指示は避けましょう。上の例のように、ファイルパス・使用ライブラリ・APIエンドポイントまで指定するほどチームメイトの作業品質が上がります。" },
        { "type": "highlight", "variant": "tip", "title": "タスクの状態遷移", "content": "各タスクは pending（未着手）→ in_progress（作業中）→ completed（完了）と自動で遷移します。あなたが手動で状態を変える必要はありません。" }
      ]
    },
    {
      "id": "step-5",
      "label": "STEP 5",
      "title": "チームメイト間の連携を理解する",
      "description": "チームメイト同士がどう連携するかを知っておきましょう。",
      "blocks": [
        { "type": "text", "content": "チームメイトはリーダーを介してメッセージをやり取りできます。例えば、バックエンドのチームメイトが作った API の型をフロントエンドのチームメイトに共有する、といった連携が可能です。" },
        { "type": "codeBlock", "language": "text", "code": "# 連携が必要な場合の指示例:\n「認証API担当のエージェントに、POST /api/auth/login の\nレスポンス型（トークンの形式やユーザー情報の構造）を\nログイン画面担当のエージェントに共有するよう伝えてください」\n\n# リーダーが自動で行うこと:\n1. 認証API担当にメッセージを送信して型情報を聞く\n2. 担当からの返答を受け取る\n3. ログイン画面担当にその情報を転送する", "caption": "あなたはリーダーに頼むだけ。メッセージの送受信はリーダーが自動で行います" },
        { "type": "highlight", "variant": "info", "title": "メッセージは自動配信", "content": "チームメイトからの完了報告や質問は、リーダーに自動配信されます。あなたが手動で受信箱をチェックする必要はありません。" },
        { "type": "highlight", "variant": "tip", "title": "broadcast は慎重に", "content": "全チームメイトへの一斉送信（broadcast）はコストが高くなります。通常は特定のチームメイトへの直接メッセージで十分です。全員に影響する重大な方針変更がある場合のみ使いましょう。" }
      ]
    },
    {
      "id": "step-6",
      "label": "STEP 6",
      "title": "タスクの進捗を管理する",
      "description": "チーム全体の進捗を把握し、必要に応じて調整します。",
      "blocks": [
        { "type": "text", "content": "リーダーに進捗を聞くだけで、全タスクの状態を一覧で確認できます。" },
        { "type": "codeBlock", "language": "text", "code": "# 進捗確認の指示例:\n「現在のタスク進捗を見せてください」\n\n# リーダーの回答例:\nタスク #1: ログイン画面の実装   ✓ 完了\nタスク #2: 認証APIの実装        ◆ 作業中\nタスク #3: 認証の結合テスト     ○ 未着手（#1, #2 の完了待ち）", "caption": "タスクの状態は「未着手」「作業中」「完了」のいずれかです" },
        { "type": "text", "content": "タスク間に依存関係を設定することもできます:" },
        { "type": "codeBlock", "language": "text", "code": "# 依存関係の指示例:\n「結合テストのタスクは、ログイン画面と認証APIの\n両方が完了してから開始してください」\n\n# 結果:\nタスク #1: ログイン画面 → \n                         → タスク #3: 結合テスト\nタスク #2: 認証API     →", "caption": "#1 と #2 が両方完了するまで #3 は自動的にブロックされます" },
        { "type": "highlight", "variant": "tip", "title": "途中で方針変更したい場合", "content": "「認証APIをJWTではなくセッション認証に変更してください」のように指示すれば、リーダーがタスクの更新と担当エージェントへの指示変更を行います。" }
      ]
    },
    {
      "id": "step-7",
      "label": "STEP 7",
      "title": "チームをシャットダウンする",
      "description": "すべてのタスクが完了したら、チームをクリーンアップします。",
      "blocks": [
        { "type": "text", "content": "全タスクが完了したら、チームの解散を指示します。リーダーが各チームメイトを安全に停止し、設定ファイルを削除します。" },
        { "type": "codeBlock", "language": "text", "code": "# シャットダウンの指示例:\n「全タスクが完了したので、チームを解散してください」\n\n# リーダーが自動で行うこと:\n1. 全タスクの完了を確認\n2. 各チームメイトに停止リクエストを送信\n3. チームメイトが承認して停止\n4. チームの設定ファイルとタスクリストを削除", "caption": "チームメイトが作業中の場合、停止は拒否されます（安全装置）" },
        { "type": "highlight", "variant": "info", "title": "まとめ: 全体のフロー", "content": "① 環境変数を設定 → ② チーム作成を指示 → ③ タスクとチームメイト起動を指示 → ④ リーダーが自動でメッセージング・進捗管理 → ⑤ 全完了後にチーム解散を指示。あなたが行うのは ①〜③ と ⑤ の指示だけです。" },
        { "type": "highlight", "variant": "tip", "title": "うまくいかないとき", "content": "チームメイトが想定と違う作業をしている場合は、リーダーに「〇〇エージェントに△△するよう修正指示を出してください」と伝えます。チームメイトが応答しない場合は、チームを解散して新しいチームで再スタートするのが確実です。" }
      ]
    }
  ],
  "summary": [
    "Agent Teams は実験的機能で、環境変数 CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1 の設定が必要",
    "Agent Teams は自然言語の指示だけで操作できること",
    "リーダー（自分のセッション）とチームメイト（子プロセス）の関係",
    "タスク作成・チームメイト起動・進捗確認の一連のフロー",
    "チームメイト間のメッセージ連携の仕組み",
    "タスクの依存関係による実行順序の制御",
    "チームの解散とクリーンアップ"
  ]
}
